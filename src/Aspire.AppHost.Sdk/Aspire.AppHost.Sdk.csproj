<Project Sdk="Microsoft.Build.NoTargets">

  <Import Project="$(SharedDir)Workload.targets" />

  <PropertyGroup>
    <PackageTags>aspire apphost sdk</PackageTags>
    <Description>.NET Aspire AppHost SDK. Must be referenced by .NET Aspire AppHost projects.</Description>
    <TargetsForTfmSpecificContentInPackage>_PublishAndPackRIDTool;$(TargetsForTfmSpecificContentInPackage)</TargetsForTfmSpecificContentInPackage>
    <EnablePackageValidation>false</EnablePackageValidation>
  </PropertyGroup>

  <ItemGroup>
    <TextReplacementValue Include="DefaultTargetFramework" NewValue="$(DefaultTargetFramework)" />
  </ItemGroup>

  <ItemGroup>
    <None Include="..\Aspire.Hosting\build\*.targets" Link="SDK\%(Filename)%(Extension)" Pack="true" PackagePath="Sdk\%(Filename)%(Extension)" CopyToOutputDirectory="PreserveNewest" />
    <None Update="SDK\AutoImport.props;SDK\*.targets" Pack="true" PackagePath="Sdk\%(Filename)%(Extension)" CopyToOutputDirectory="PreserveNewest" />
    <None Update="SDK\Sdk.in.props" Pack="true" PerformTextReplacement="True" PackagePath="Sdk\Sdk.props" CopyToOutputDirectory="PreserveNewest" />
    <None Update="SDK\Sdk.in.targets" Pack="true" PerformTextReplacement="True" PackagePath="Sdk\Sdk.targets" />

    <!-- Adding a project reference to the tool to avoid MSBuild having clashes when building this project before the other. -->
    <ProjectReference Include="Aspire.AppHost.Tasks\Aspire.AppHost.Tasks.csproj" Private="true" />
  </ItemGroup>

  <Target Name="_PublishAndPackRIDTool">
    <MSBuild Projects="@(ProjectReference)" Targets="Build" Properties="TargetFramework=netstandard2.0">
      <Output TaskParameter="TargetOutputs" ItemName="TaskDlls" />
      
    </MSBuild>
    <ItemGroup>
      <TfmSpecificPackageFile Include="@(TaskDlls)" PackagePath="tasks/netstandard2.0/%(TaskDlls.RecursiveDir)" />
    </ItemGroup>

  </Target>

</Project>
